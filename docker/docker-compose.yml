version: '2.2'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.14.2
    container_name: tvh_elasticsearch
    #    build: es
    environment:
      - node.name=elasticsearch_tvh
      - discovery.type=single-node
      - cluster.name=docker-cluster
      - "ES_JAVA_OPTS=-Xms2048m -Xmx2048m"
    ulimits:
      memlock:
        soft: -1
        hard: -1
    networks:
      - docker-elk
    volumes:
      - ./ltr/ltr-1.5.7-es7.14.2.zip:/tmp/ltr/ltr-1.5.7-es7.14.2.zip:ro
    ports:
      - 9203:9200
  kibana:
    image: docker.elastic.co/kibana/kibana:7.14.2
    container_name: tvh_kibana
    environment:
      - ELASTICSEARCH_URL=http://tvh_elasticsearch:9200/
    networks:
      - docker-elk
    ports:
      - 5603:5601
    depends_on:
      - elasticsearch
  logstash:
    image: docker.elastic.co/logstash/logstash-oss:7.14.2
    ports:
      - 5000:5000
      - 5001:5001
      - 5002:5002
    networks:
      - docker-elk
    command: bash -c "bin/logstash-plugin install logstash-input-tcp && bin/logstash-plugin install logstash-input-http && bin/logstash-plugin install logstash-input-udp && bin/logstash-plugin install logstash-filter-grok && logstash -f /etc/logstash/conf.d/logstash.conf"
    volumes:
      - ./logstash/logstash.conf:/etc/logstash/conf.d/logstash.conf:ro
    depends_on:
      - elasticsearch
    links:
      - elasticsearch
networks:
  odfe-net:
  docker-elk:
  backing-services:
    driver: bridge
volumes:
  postgres-data: { }